{% extends "base.html" %}

{% block title %}{{ plant.common_name }} - PlantTracker{% endblock %}

{% block extra_css %}
<style>
    .detail-header {
        background: linear-gradient(135deg, #045138 0%, #4ba26d 100%);
        color: white;
        padding: 30px;
        border-radius: 10px;
        margin-bottom: 30px;
    }
    
    .detail-header h2 {
        margin-bottom: 10px;
    }
    
    .detail-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .info-card {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        border-left: 4px solid #56866a;
    }
    
    .info-card h3 {
        color: #56866a;
        margin-bottom: 15px;
        font-size: 1.2em;
    }
    
    .info-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #dee2e6;
    }
    
    .info-item:last-child {
        border-bottom: none;
    }
    
    .info-label {
        font-weight: 600;
        color: #495057;
    }
    
    .info-value {
        color: #6c757d;
    }
    
    .section {
        background: white;
        padding: 25px;
        border-radius: 10px;
        margin-bottom: 20px;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    
    .section h3 {
        color: #56866a;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #56866a;
    }
    
    .event-list {
        list-style: none;
    }
    
    .event-item {
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #3498db;
    }
    
    .event-item.zalijevanje {
        border-left-color: #3498db;
    }
    
    .event-item.gnojenje {
        border-left-color: #f39c12;
    }
    
    .event-item.presađivanje {
        border-left-color: #9b59b6;
    }
    
    .event-item.rezanje {
        border-left-color: #e74c3c;
    }
    
    .event-item.bolest {
        border-left-color: #c0392b;
    }
    
    .event-item.napomena {
        border-left-color: #95a5a6;
    }
    
    .event-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-weight: 600;
    }
    
    .event-type {
        color: #2c3e50;
        text-transform: capitalize;
    }
    
    .event-date {
        color: #7f8c8d;
        font-size: 0.9em;
    }
    
    .event-description {
        color: #6c757d;
        margin-top: 5px;
    }
    
    .reminder-list {
        list-style: none;
    }
    
    .reminder-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        margin-bottom: 10px;
        background: #fff3cd;
        border-radius: 8px;
        border-left: 4px solid #ffc107;
    }
    
    .reminder-info {
        flex: 1;
    }
    
    .reminder-type {
        font-weight: 600;
        color: #2c3e50;
        text-transform: capitalize;
    }
    
    .reminder-next {
        color: #6c757d;
        font-size: 0.9em;
        margin-top: 5px;
    }
    
    .image-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 15px;
    }
    
    .image-card {
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .image-card img {
        width: 100%;
        height: 200px;
        object-fit: cover;
    }
    
    .image-caption {
        padding: 10px;
        background: #f8f9fa;
        font-size: 0.9em;
        color: #6c757d;
    }
    
    .growth-chart {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin-top: 15px;
    }
    
    .growth-item {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        margin-bottom: 8px;
        background: white;
        border-radius: 5px;
    }
    
    .action-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
    }
    
    .tabs {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        border-bottom: 2px solid #dee2e6;
    }
    
    .tab {
        padding: 10px 20px;
        background: transparent;
        border: none;
        cursor: pointer;
        font-size: 1em;
        color: #6c757d;
        border-bottom: 3px solid transparent;
        transition: all 0.3s;
    }
    
    .tab.active {
        color: #56866a;
        border-bottom-color: #56866a;
    }
    
    .tab:hover {
        color: #56866a;
    }
    
    .tab-content {
        display: none;
    }
    
    .tab-content.active {
        display: block;
    }
</style>
{% endblock %}

{% block content %}
<a href="/" class="btn" style="margin-bottom: 20px;">Natrag na pregled</a>

<div class="detail-header">
    <h2>{{ plant.common_name }}</h2>
    {% if plant.scientific_name %}
    <p style="font-style: italic; opacity: 0.9;">{{ plant.scientific_name }}</p>
    {% endif %}
    {% if plant.variety %}
    <p style="opacity: 0.8;">Sorta: {{ plant.variety }}</p>
    {% endif %}
    <span class="status {{ plant.current_status }}">{{ plant.current_status }}</span>
</div>

<!-- Osnovne informacije -->
<div class="detail-grid">
    <div class="info-card">
        <h3>Osnovni podaci</h3>
        <div class="info-item">
            <span class="info-label">Lokacija:</span>
            <span class="info-value">{{ plant.location or 'Nepoznato' }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Datum sadnje:</span>
            <span class="info-value">{{ plant.planting_date.strftime('%d.%m.%Y') }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Izvor nabave:</span>
            <span class="info-value">{{ plant.acquisition_source or 'Nepoznato' }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Dob biljke:</span>
            <span class="info-value">{{ report.days_since_planting }} dana</span>
        </div>
    </div>
    
    <div class="info-card">
        <h3>Statistika</h3>
        <div class="info-item">
            <span class="info-label">Ukupno događaja:</span>
            <span class="info-value">{{ report.total_events }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Aktivni podsjetnici:</span>
            <span class="info-value">{{ report.active_reminders }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Broj slika:</span>
            <span class="info-value">{{ report.total_images }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Zadnje zalijevanje:</span>
            <span class="info-value">
                {% if report.last_watered %}
                    {{ report.last_watered.strftime('%d.%m.%Y %H:%M') }}
                {% else %}
                    Nema podataka
                {% endif %}
            </span>
        </div>
    </div>
    
    <div class="info-card">
        <h3>Podsjetnici</h3>
        {% if reminders %}
            {% for reminder in reminders[:3] %}
            <div class="info-item">
                <span class="info-label">{{ reminder.reminder_type|capitalize }}:</span>
                <span class="info-value">{{ reminder.next_due.strftime('%d.%m.%Y') }}</span>
            </div>
            {% endfor %}
        {% else %}
            <p class="info-value">Nema aktivnih podsjetnika</p>
        {% endif %}
    </div>
</div>

<!-- Tabovi -->
<div class="tabs">
    <button class="tab active" onclick="showTab('events')">Povijest događaja</button>
    <button class="tab" onclick="showTab('reminders')">Podsjetnici</button>
    <button class="tab" onclick="showTab('growth')">Rast</button>
    <button class="tab" onclick="showTab('images')">Galerija</button>
</div>

<!-- Tab sadržaji -->
<div id="events-tab" class="tab-content active">
    <div class="section">
        <h3>Povijest događaja</h3>
        {% if events %}
        <ul class="event-list">
            {% for event in events %}
            <li class="event-item {{ event.event_type }}">
                <div class="event-header">
                    <span class="event-type">{{ event.event_type }}</span>
                    <span class="event-date">{{ event.event_date.strftime('%d.%m.%Y %H:%M') }}</span>
                </div>
                {% if event.description %}
                <div class="event-description">{{ event.description }}</div>
                {% endif %}
                {% if event.amount %}
                <div class="event-description">Količina: {{ event.amount }}</div>
                {% endif %}
                {% if event.performed_by %}
                <div class="event-description" style="font-style: italic;">Izvršio: {{ event.performed_by }}</div>
                {% endif %}
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>Nema zabilježenih događaja za ovu biljku.</p>
        {% endif %}
        
        <div class="action-buttons">
            <button class="btn" onclick="alert('Funkcionalnost za dodavanje događaja će biti implementirana kroz API')">
                Dodaj događaj
            </button>
            <a href="/plant/{{ plant.plant_id }}/history" class="btn">
                Temporalna povijest
            </a>
        </div>
    </div>
</div>

<div id="reminders-tab" class="tab-content">
    <div class="section">
        <h3>Aktivni podsjetnici</h3>
        {% if reminders %}
        <ul class="reminder-list">
            {% for reminder in reminders %}
            <li class="reminder-item">
                <div class="reminder-info">
                    <div class="reminder-type">
                        {{ reminder.reminder_type }}
                    </div>
                    <div class="reminder-next">
                        Sljedeći put: {{ reminder.next_due.strftime('%d.%m.%Y %H:%M') }}
                    </div>
                    <div class="reminder-next">
                        Frekvencija: {{ reminder.frequency }}
                    </div>
                    {% if reminder.notes %}
                    <div class="reminder-next">{{ reminder.notes }}</div>
                    {% endif %}
                </div>
                <button class="btn btn-danger" onclick="deleteReminder({{ reminder.reminder_id }})">
                    Obriši
                </button>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p>Nema aktivnih podsjetnika za ovu biljku.</p>
        {% endif %}
        
        <button class="btn" onclick="alert('Funkcionalnost za dodavanje podsjetnika će biti implementirana kroz API')">
            Dodaj podsjetnik
        </button>
    </div>
</div>

<div id="growth-tab" class="tab-content">
    <div class="section">
        <h3>Trend rasta (zadnjih 90 dana)</h3>
        {% if growth %}
        <div class="growth-chart">
            {% for measurement in growth %}
            <div class="growth-item">
                <span>{{ measurement.measurement_date.strftime('%d.%m.%Y') }}</span>
                <span>
                    {% if measurement.height_cm %}Visina: {{ measurement.height_cm }} cm{% endif %}
                    {% if measurement.height_change %}
                        ({% if measurement.height_change > 0 %}+{% endif %}{{ measurement.height_change }} cm)
                    {% endif %}
                </span>
                <span>
                    {% if measurement.leaf_count %}Listovi: {{ measurement.leaf_count }}{% endif %}
                </span>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Nema zabilježenih mjerenja rasta.</p>
        {% endif %}
        
        <button class="btn" onclick="alert('Funkcionalnost za dodavanje mjerenja će biti implementirana kroz API')">
            Dodaj mjerenje
        </button>
    </div>
</div>

<div id="images-tab" class="tab-content">
    <div class="section">
        <h3>Galerija slika</h3>
        {% if images %}
        <div class="image-gallery">
            {% for image in images %}
            <div class="image-card">
                <img src="{{ image.file_path }}" alt="{{ image.caption or plant.common_name }}" 
                     onerror="this.src='https://via.placeholder.com/200x200?text=Slika+nije+dostupna'">
                <div class="image-caption">
                    {% if image.caption %}{{ image.caption }}{% endif %}
                    <br>
                    <small>{{ image.taken_at.strftime('%d.%m.%Y') }}</small>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <p>Nema slika za ovu biljku.</p>
        {% endif %}
        
        <button class="btn" onclick="alert('Funkcionalnost za upload slika će biti implementirana kroz API')">
            Dodaj sliku
        </button>
    </div>
</div>

<!-- Bilješke -->
{% if plant.notes %}
<div class="section">
    <h3>Bilješke</h3>
    <p style="color: #6c757d; line-height: 1.6;">{{ plant.notes }}</p>
</div>
{% endif %}

<!-- Akcije -->
<div class="action-buttons">
    <button class="btn" onclick="alert('Funkcionalnost za uređivanje biljke će biti implementirana kroz API')">
        Uredi biljku
    </button>
    <button class="btn btn-danger" onclick="deletePlant('{{ plant.plant_id }}')">
        Obriši biljku
    </button>
</div>

{% endblock %}

{% block extra_js %}
<script>
function showTab(tabName) {
    // Sakrij sve tab sadržaje
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    // Ukloni active klasu sa svih tabova
    document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
    });
    
    // Prikaži odabrani tab
    document.getElementById(tabName + '-tab').classList.add('active');
    
    // Označi odabrani tab kao aktivan
    event.target.classList.add('active');
}

function deleteReminder(reminderId) {
    if (confirm('Jeste li sigurni da želite obrisati ovaj podsjetnik?')) {
        fetch(`/api/reminder/${reminderId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Podsjetnik uspješno obrisan!');
                location.reload();
            } else {
                alert('Greška: ' + data.error);
            }
        })
        .catch(error => {
            alert('Greška prilikom brisanja: ' + error);
        });
    }
}

function deletePlant(plantId) {
    if (confirm('Jeste li sigurni da želite obrisati ovu biljku? Ova akcija je nepovratna!')) {
        fetch(`/api/plant/${plantId}`, {
            method: 'DELETE'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('Biljka uspješno obrisana!');
                window.location.href = '/';
            } else {
                alert('Greška: ' + data.error);
            }
        })
        .catch(error => {
            alert('Greška prilikom brisanja: ' + error);
        });
    }
}
</script>
{% endblock %}
